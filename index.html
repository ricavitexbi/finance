<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="VitexAI - Financial Intelligence Dashboard with Advanced Analytics">
    <title>VitexAI | Financial Intelligence Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='60' width='15' height='30' fill='%23718096'/><rect x='30' y='40' width='15' height='50' fill='%234A5568'/><rect x='50' y='50' width='15' height='40' fill='%234A5568'/><rect x='70' y='30' width='15' height='60' fill='%232E86AB'/><path d='M 5 55 L 45 15 L 50 20 L 10 60 Z' fill='%232E86AB'/><polygon points='45,15 55,15 50,5' fill='%232E86AB'/></svg>">
    <style>
        /* estilos existentes mantidos */
    </style>
</head>
<body>
    <!-- content HTML existente mantido -->

    <!-- Tab 4: Projeções -->
    <div id="projections" class="tab-content">
        <h3 class="font-semibold" style="font-size: 1.25rem; color: var(--dark-gray); margin-bottom: 24px;">
            Projections & Goals
        </h3>
        <div class="metrics-grid">
            <!-- outros cards existentes -->
            <div class="metric-card">
                <div class="metric-title">Forecast ML (Próx. Mês)</div>
                <div class="metric-value" id="receitaProjetadaML">—</div>
                <div class="metric-trend">via Holt Model</div>
            </div>
        </div>
        <!-- resto da aba permaneceu igual -->
    </div>

    <script>
        // URL do serviço de ML no Render
        const ML_BASE_URL = "https://vitexai-ml.onrender.com";

        /**
         * Função para buscar previsões do serviço de ML
         */
        async function forecastCashflow(months = 3) {
            try {
                const response = await fetch(`${ML_BASE_URL}/predict_cashflow/?months=${months}`);
                if (!response.ok) {
                    console.error('Erro na API de previsão:', response.status, response.statusText);
                    return [];
                }
                const data = await response.json();
                return data.predictions || [];
            } catch (err) {
                console.error('Não foi possível obter previsões:', err);
                return [];
            }
        }

        // Torna showTab assíncrona
        async function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'projections') {
                await updateProjections();
            }
            if (tabName === 'charts') {
                setTimeout(createCharts, 100);
            }
        }

        // Atualiza projeções incluindo ML
        async function updateProjections() {
            const monthlyData = getMonthlyData();
            if (monthlyData.length === 0) {
                updateElement('receitaProjetada', formatCurrency(0));
                updateElement('breakEven', formatCurrency(0));
                updateElement('runway', '0');
                updateElement('runwayTrend', 'No historical data');
                return;
            }

            // Busca previsão ML para 1 mês
            const preds = await forecastCashflow(1);
            const elML = document.getElementById('receitaProjetadaML');
            if (preds.length > 0) {
                elML.textContent = formatCurrency(preds[0]);
            } else {
                elML.textContent = 'Erro';
            }

            // Continua com cálculos locais (mantém seu código original abaixo)
            // ...
        }

        // restante do seu script (funções utilitárias, atualização de dashboards, etc.)
    </script>
</body>
</html>
